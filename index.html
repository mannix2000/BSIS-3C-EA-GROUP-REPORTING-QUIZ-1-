<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BSIS Exam — IS105: Integrating Applications (Concepts, Levels, and Strategies)</title>
<style>
  body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f6f8fb;color:#0f172a;user-select:none;}
  header{background:#fff;padding:16px;display:flex;align-items:center;gap:12px;box-shadow:0 1px 6px rgba(0,0,0,.1);}
  header h1{margin:0;font-size:1.15rem;} 
  header .timer{margin-left:auto;padding:8px 12px;background:#ffe5e5;color:#b00020;font-weight:700;border-radius:50px;}
  main{max-width:980px;margin:20px auto;padding:12px;}
  .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05);margin-bottom:12px;}
  label{display:block;margin:8px 0 4px;font-weight:600;}
  select,input[type=text]{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;}
  button{background:#1f6feb;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-weight:700;cursor:pointer;}
  button.secondary{background:#eef2ff;color:#1f6feb;}
  .hidden{display:none!important;}
  .muted{color:#6b7280;font-size:.9rem;}

/* Google Fonts */
@import url('https://fonts.googleapis.com/css?family=Anonymous+Pro');

/* Global */
.line-1 {
  position: relative;
  top: 50%;
  width: 42em; /* Adjusted width for long sentence */
  margin: 0 auto;
  border-right: 2px solid rgba(255,255,255,.75);
  font-size: 1.2rem; /* readable size */
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  transform: translateY(-100%);
  color: rgb(236, 8, 8); /* optional */
}

/* Animation */
.anim-typewriter {
  animation: 
    typewriter 6s steps(75) 1s 1 normal both, /* adjusted timing */
    blinkTextCursor 500ms steps(75) infinite normal;
}

@keyframes typewriter {
  from { width: 0; }
  to { width: 42em; } /* must match .line-1 width */
}

@keyframes blinkTextCursor {
  from { border-right-color: rgba(255,255,255,.75); }
  to { border-right-color: transparent; }
}

</style>
</head>
<body>

<header>
  <h1>BSIS Exam — IS105: Integrating Applications (Concepts, Levels, and Strategies)</h1>
  <div class="timer" id="timer">35:00</div>
</header>

<main>
  <section class="card" id="accessCodeSection">
    <label>Enter Exam Access Code:</label>
    <input type="text" id="examCodeInput" placeholder="Enter code here">
    <button type="button" id="examCodeBtn">Start Exam</button>
    <p id="codeError" class="muted" style="color:red; display:none;">Incorrect code. Please try again.</p>
    <p class="muted" style="margin-top:8px;">Use access code provided by your instructor.</p>
  </section>

  <form id="examForm" class="card hidden" autocomplete="off">
    <p class="line-1 anim-typewriter">Paano mo pipilitin ang puso mong lumimot, kung siya rin ang dahilan kung bakit ito tumitibok?</p>
    <label>Student Name</label>
    <input type="text" id="studentName" name="studentName" placeholder="Last name, First name">
    <hr>

    <!-- ====== QUESTIONS 1–20 ====== -->

    <label>1. What is the main objective of application integration in an enterprise architecture?</label>
    <!-- Correct: A -->
    <select name="q1"><option value="">Select answer</option>
      <option>A. To enable seamless communication and coordinated processes between heterogeneous systems</option>
      <option>B. To consolidate all software into a single platform and remove modularity</option>
      <option>C. To isolate each application for independent performance monitoring only</option>
      <option>D. To ensure systems never exchange data directly</option>
    </select>

    <label>2. Which integration level focuses on synchronizing and transforming data across systems?</label>
    <!-- Correct: C -->
    <select name="q2"><option value="">Select answer</option>
      <option>A. Interface-Level Integration managing workflow events across departments</option>
      <option>B. User Interface-Level Integration merging front-end experiences</option>
      <option>C. Data-Level Integration ensuring consistency through ETL and schema mapping</option>
      <option>D. Process-Level Integration orchestrating multi-system transactions</option>
    </select>

    <label>3. A logistics firm connects its shipment tracking system to the warehouse database to update delivery data automatically. What level of integration is demonstrated?</label>
    <!-- Correct: D -->
    <select name="q3"><option value="">Select answer</option>
      <option>A. User Interface-Level Integration displaying multiple systems in one portal</option>
      <option>B. API-Led Integration creating a service mesh for all delivery endpoints</option>
      <option>C. Enterprise Service Bus Integration using middleware message brokers</option>
      <option>D. Data-Level Integration automating data exchange between transactional systems</option>
    </select>

    <label>4. Which approach best describes API-Led Integration in modern digital transformation?</label>
    <!-- Correct: A -->
    <select name="q4"><option value="">Select answer</option>
      <option>A. Organizing APIs into system, process, and experience layers for reusability and modularity</option>
      <option>B. Building isolated service calls without reuse to avoid dependencies</option>
      <option>C. Using file transfers between endpoints to replicate data</option>
      <option>D. Exchanging information manually via dashboards</option>
    </select>

    <label>5. An enterprise service bus (ESB) improves communication among systems primarily by:</label>
    <!-- Correct: B -->
    <select name="q5"><option value="">Select answer</option>
      <option>A. Creating point-to-point direct connections between every system</option>
      <option>B. Handling message routing, transformation, and protocol mediation in a centralized hub</option>
      <option>C. Replacing legacy systems with new microservices immediately</option>
      <option>D. Storing redundant copies of every database table</option>
    </select>

    <label>6. In integration strategy, what is a primary limitation of the point-to-point approach?</label>
    <!-- Correct: D -->
    <select name="q6"><option value="">Select answer</option>
      <option>A. It reduces the number of required connections dramatically</option>
      <option>B. It introduces a centralized monitoring capability for every service</option>
      <option>C. It ensures strong standardization across all APIs</option>
      <option >D. It becomes complex and hard to manage as the number of systems increases</option>
    </select>

    <label>7. A healthcare organization introduces middleware to manage data exchange between legacy and cloud systems. This architecture represents:</label>
    <!-- Correct: A -->
    <select name="q7"><option value="">Select answer</option>
      <option >A. Hub-and-Spoke Integration providing centralized message transformation and monitoring</option>
      <option>B. Point-to-Point Integration relying on independent direct system links</option>
      <option>C. File-based Integration using CSV transfers for synchronization</option>
      <option>D. User Interface-Level Integration embedding external modules on one screen</option>
    </select>

    <label>8. What distinguishes process-level integration from interface-level integration?</label>
    <!-- Correct: B -->
    <select name="q8"><option value="">Select answer</option>
      <option>A. Process-level integration focuses only on user interfaces</option>
      <option >B. Process-level integration coordinates workflow logic across systems, while interface-level handles data presentation</option>
      <option>C. Interface-level integration executes background jobs without user interaction</option>
      <option>D. Both involve only API gateway security policies</option>
    </select>

    <label>9. Which integration scenario best illustrates the use of web services?</label>
    <!-- Correct: C -->
    <select name="q9"><option value="">Select answer</option>
      <option>A. Two desktop applications sharing the same configuration file</option>
      <option>B. Manual import/export between databases each week</option>
      <option >C. Systems exchanging data using SOAP or REST protocols defined by WSDL or OpenAPI</option>
      <option>D. A mobile app copying data from spreadsheets offline</option>
    </select>

    <label>10. A finance company connects several internal APIs to external vendor systems. Which integration strategy best ensures scalability?</label>
    <!-- Correct: D -->
    <select name="q10"><option value="">Select answer</option>
      <option>A. Maintaining manual file uploads between teams</option>
      <option>B. Building direct connections between every internal and external service</option>
      <option>C. Migrating all systems into one monolithic application</option>
      <option>D. Implementing API-Led Integration with reusable, layered endpoints</option>
    </select>

    <label>11. Which example reflects user interface–level integration?</label>
    <!-- Correct: A -->
    <select name="q11"><option value="">Select answer</option>
      <option>A. A dashboard combining CRM, HR, and sales modules from separate systems into one unified portal</option>
      <option>B. An ETL job aggregating data from different warehouses</option>
      <option>C. A queue-based message exchange for asynchronous tasks</option>
      <option>D. A back-end batch processing job without user display</option>
    </select>

    <label>12. Why is XML still used in enterprise integrations despite JSON’s popularity?</label>
    <!-- Correct: B -->
    <select name="q12"><option value="">Select answer</option>
      <option>A. XML is simpler than JSON and requires no schema validation</option>
      <option>B. XML supports schema validation, namespaces, and complex hierarchical data structures</option>
      <option>C. XML only works with flat data representations</option>
      <option>D. XML cannot be used in SOAP-based integrations</option>
    </select>

    <label>13. What is the primary role of middleware in application integration?</label>
    <!-- Correct: C -->
    <select name="q13"><option value="">Select answer</option>
      <option>A. To replace all backend systems with one unified application</option>
      <option>B. To host all user interfaces on a centralized server</option>
      <option>C. To act as an intermediary that manages routing, transformation, and connectivity among systems</option>
      <option>D. To replicate databases for offline reporting only</option>
    </select>

    <label>14. Which statement best defines enterprise application integration (EAI)?</label>
    <!-- Correct: A -->
    <select name="q14"><option value="">Select answer</option>
      <option>A. A framework enabling applications to communicate through standardized middleware or message buses</option>
      <option>B. A database architecture focused purely on analytics</option>
      <option>C. A mobile-first development model for user apps</option>
      <option>D. A programming paradigm for front-end design</option>
    </select>

    <label>15. What is the biggest risk when using file-based integration as the main method of data exchange?</label>
    <!-- Correct: D -->
    <select name="q15"><option value="">Select answer</option>
      <option>A. Increased transaction throughput and real-time updates</option>
      <option>B. Enhanced message validation and version control</option>
      <option>C. Simplified maintenance through schema-driven APIs</option>
      <option>D. Delays, duplication, and data inconsistency due to batch timing errors</option>
    </select>

    <label>16. Which integration method supports real-time communication between cloud and on-premise systems?</label>
    <!-- Correct: C -->
    <select name="q16"><option value="">Select answer</option>
      <option>A. Manual data migration through Excel uploads</option>
      <option>B. Nightly ETL-based synchronization jobs</option>
      <option>C. API integration using secure, asynchronous endpoints for data transfer</option>
      <option>D. One-time SQL imports from archived datasets</option>
    </select>

    <label>17. A retail company integrates multiple applications to synchronize product catalogs instantly. What integration pattern fits this case?</label>
    <!-- Correct: B -->
    <select name="q17"><option value="">Select answer</option>
      <option>A. Batch integration through overnight uploads</option>
      <option>B. Event-driven API integration publishing updates in real-time</option>
      <option>C. Manual entry using shared spreadsheets</option>
      <option>D. Legacy file transfer via FTP</option>
    </select>

    <label>18. A firm migrating to cloud wants flexible connectivity without tight coupling. Which integration style supports this?</label>
    <!-- Correct: A -->
    <select name="q18"><option value="">Select answer</option>
      <option selected>A. API-led, loosely coupled integration using microservices and gateways</option>
      <option>B. Point-to-point synchronous calls with hard-coded dependencies</option>
      <option>C. Monolithic ERP consolidation with shared DB schema</option>
      <option>D. Flat-file replication between local servers</option>
    </select>

    <label>19. What is the key difference between integration and interoperability?</label>
    <!-- Correct: C -->
    <select name="q19"><option value="">Select answer</option>
      <option>A. Integration refers only to hardware, while interoperability focuses on software</option>
      <option>B. Integration is broader and includes governance, while interoperability is informal</option>
      <option selected>C. Integration is about connecting systems; interoperability is about them understanding and using exchanged data</option>
      <option>D. They are completely identical terms used interchangeably</option>
    </select>

    <label>20. A university uses APIs to connect enrollment, billing, and student portals. Which overall benefit does this integration provide?</label>
    <!-- Correct: D -->
    <select name="q20"><option value="">Select answer</option>
      <option>A. Increased data redundancy across departments</option>
      <option>B. Limited data access for security reasons</option>
      <option>C. Reduced scalability by isolating subsystems</option>
      <option>D. Unified data visibility and improved coordination between academic and finance systems</option>
    </select>

    <!-- ====== QUESTIONS 21–40 ====== -->

    <label>21. A bank integrates its core banking and mobile app systems. Customers now see transactions instantly after processing. Which integration type was applied?</label>
    <!-- Correct: B -->
    <select name="q21"><option value="">Select answer</option>
      <option>A. File-based integration with batch upload of transactions</option>
      <option>B. Real-time API integration ensuring immediate synchronization between systems</option>
      <option>C. Manual data replication using shared tables</option>
      <option>D. User interface integration through shared dashboards only</option>
    </select>

    <label>22. A logistics company connects third-party shipment providers through a single middleware that normalizes data formats. This is an example of:</label>
    <!-- Correct: C -->
    <select name="q22"><option value="">Select answer</option>
      <option>A. Point-to-point integration between logistics vendors</option>
      <option>B. File-based manual consolidation through batch imports</option>
      <option>C. Hub-and-Spoke integration where middleware acts as the central hub</option>
      <option>D. Decentralized integration with no control or mapping layer</option>
    </select>

    <label>23. An insurance firm uses APIs to retrieve claims from a legacy mainframe via an adapter. Which integration pattern is used?</label>
    <!-- Correct: A -->
    <select name="q23"><option value="">Select answer</option>
      <option>A. Legacy integration using an adapter layer to expose legacy functions through APIs</option>
      <option>B. File synchronization scheduled weekly</option>
      <option>C. Point-to-point connection between each branch database</option>
      <option>D. Cloud-only microservices disconnected from legacy systems</option>
    </select>

    <label>24. During migration, an IT team implements ESB but performance drops. What optimization is most effective?</label>
    <!-- Correct: D -->
    <select name="q24"><option value="">Select answer</option>
      <option>A. Add more synchronous connections and complex routing rules</option>
      <option>B. Disable message queuing and monitoring</option>
      <option>C. Replace middleware with direct SQL data pulls</option>
      <option>D. Use asynchronous messaging, load balancing, and routing optimization within the ESB</option>
    </select>

    <label>25. Which integration scenario best supports scalability in microservices architecture?</label>
    <!-- Correct: B -->
    <select name="q25"><option value="">Select answer</option>
      <option>A. Each microservice communicates directly with every other service</option>
      <option>B. Microservices use an API gateway and asynchronous event bus for loosely coupled communication</option>
      <option>C. Systems rely on shared global variables for interaction</option>
      <option>D. Each module synchronizes data via spreadsheets</option>
    </select>

    <label>26. A telecom firm’s customer portal displays data from billing, network, and CRM. Which integration level supports this?</label>
    <!-- Correct: A -->
    <select name="q26"><option value="">Select answer</option>
      <option>A. User interface–level integration combining multiple systems into a unified view</option>
      <option>B. Process-level integration using batch ETL pipelines</option>
      <option>C. Data-level integration only through shared databases</option>
      <option>D. File-based integration through scheduled reports</option>
    </select>

    <label>27. A developer notices that a REST API returns inconsistent data formats across systems. Which best practice resolves this?</label>
    <!-- Correct: C -->
    <select name="q27"><option value="">Select answer</option>
      <option>A. Allow each system to define its own schema and ignore mismatches</option>
      <option>B. Use manual mapping inside the client applications</option>
      <option>C. Define a consistent data contract and enforce schema validation at the API gateway</option>
      <option>D. Disable validation and rely on client logic for conversion</option>
    </select>

    <label>28. A government IT team integrates citizen service systems via ESB and experiences delays in response time. Which design improvement can enhance performance?</label>
    <!-- Correct: D -->
    <select name="q28"><option value="">Select answer</option>
      <option>A. Increase the number of synchronous API calls per transaction</option>
      <option>B. Replace asynchronous queues with blocking calls</option>
      <option>C. Use point-to-point links to bypass the ESB</option>
      <option>D. Introduce caching, asynchronous messaging, and prioritization of real-time transactions</option>
    </select>

    <label>29. Which advantage is achieved through process-level integration?</label>
    <!-- Correct: A -->
    <select name="q29"><option value="">Select answer</option>
      <option>A. Coordination of end-to-end workflows across multiple enterprise systems</option>
      <option>B. Display of combined data views in one dashboard</option>
      <option>C. Direct file synchronization between two data servers</option>
      <option>D. Real-time editing of database tables via SQL console</option>
    </select>

    <label>30. A multinational enterprise wants to connect on-prem and SaaS systems. Which integration solution offers best long-term maintainability?</label>
    <!-- Correct: B -->
    <select name="q30"><option value="">Select answer</option>
      <option>A. Hard-coded FTP scripts for each SaaS vendor</option>
      <option>B. Cloud integration platform (iPaaS) offering API connectors and monitoring tools</option>
      <option>C. Shared Excel templates maintained manually</option>
      <option>D. Separate databases synchronized through manual uploads</option>
    </select>

    <label>31. Which principle should guide secure API integration between external vendors?</label>
    <!-- Correct: C -->
    <select name="q31"><option value="">Select answer</option>
      <option>A. Store credentials in plain text for faster testing</option>
      <option>B. Allow unrestricted access for faster response times</option>
      <option>C. Use token-based authentication, encryption, and access control policies</option>
      <option>D. Disable SSL verification to simplify configuration</option>
    </select>

    <label>32. A university system needs to integrate its HR, student, and finance modules while maintaining loose coupling. Which approach works best?</label>
    <!-- Correct: D -->
    <select name="q32"><option value="">Select answer</option>
      <option>A. Merge all modules into a monolithic ERP</option>
      <option>B. Run nightly ETL jobs across shared databases</option>
      <option>C. Implement direct API calls without middleware</option>
      <option>D. Use middleware or ESB to handle message routing and transformation between modules</option>
    </select>

    <label>33. During API-led integration, developers introduce three layers: system, process, and experience. What is the role of the process layer?</label>
    <!-- Correct: B -->
    <select name="q33"><option value="">Select answer</option>
      <option>A. Handles UI customization for different user types</option>
      <option>B. Orchestrates and combines data from multiple system APIs into business workflows</option>
      <option>C. Secures tokens and user sessions for all applications</option>
      <option>D. Executes low-level file transfers between databases</option>
    </select>

    <label>34. A manufacturing company integrates equipment sensors with analytics dashboards via IoT gateways. Which integration model applies?</label>
    <!-- Correct: A -->
    <select name="q34"><option value="">Select answer</option>
      <option>A. Real-time event-driven integration using message brokers and streaming APIs</option>
      <option>B. Manual data upload via CSV from sensors</option>
      <option>C. Batch aggregation through ETL every weekend</option>
      <option>D. Static report generation via spreadsheets</option>
    </select>

    <label>35. What challenge commonly arises when scaling point-to-point integrations?</label>
    <!-- Correct: D -->
    <select name="q35"><option value="">Select answer</option>
      <option>A. Reduced data flow complexity</option>
      <option>B. Centralized management through unified middleware</option>
      <option>C. Simplified debugging of all connections</option>
      <option>D. Exponential increase in connection dependencies and maintenance overhead</option>
    </select>

    <label>36. A developer is tasked to integrate CRM, ERP, and analytics tools to share consistent data. Which design ensures minimal duplication?</label>
    <!-- Correct: C -->
    <select name="q36"><option value="">Select answer</option>
      <option>A. Each system maintains independent data without synchronization</option>
      <option>B. Manual exports between systems on a weekly schedule</option>
      <option selected>C. Centralized master data integration ensuring all systems consume validated datasets</option>
      <option>D. Copying transactional data between all systems randomly</option>
    </select>

    <label>37. Which integration approach best supports future scalability and modular system design?</label>
    <!-- Correct: B -->
    <select name="q37"><option value="">Select answer</option>
      <option>A. Hard-coded scripts directly linking every subsystem</option>
      <option>B. API-based modular architecture with independent service layers</option>
      <option>C. Manual CSV uploads maintained by IT staff</option>
      <option>D. Shared monolithic database for all applications</option>
    </select>

    <label>38. A cloud provider implements rate limits on external API calls. Which integration safeguard avoids downtime?</label>
    <!-- Correct: A -->
    <select name="q38"><option value="">Select answer</option>
      <option>A. Use circuit breakers, caching, and fallback logic to handle throttling gracefully</option>
      <option>B. Increase the number of parallel API requests continuously</option>
      <option>C. Disable authentication to reduce latency</option>
      <option>D. Retry requests endlessly without limits</option>
    </select>

    <label>39. A public service portal requires integrating multiple department systems with consistent user access. What is the key integration requirement?</label>
    <!-- Correct: D -->
    <select name="q39"><option value="">Select answer</option>
      <option>A. Separate credentials per system for all users</option>
      <option>B. File-level synchronization among departments</option>
      <option>C. Independent access layers for each department system</option>
      <option>D. Single sign-on and federated identity management across integrated systems</option>
    </select>

    <label>40. After integrating enterprise systems, management wants metrics showing integration success. Which indicator best demonstrates value?</label>
    <!-- Correct: B -->
    <select name="q40"><option value="">Select answer</option>
      <option>A. Number of systems connected regardless of usage</option>
      <option>B. Reduction in data redundancy, improved response time, and increased process automation</option>
      <option>C. Count of deployed APIs without performance tracking</option>
      <option>D. Number of servers added to handle integration load</option>
    </select>

    <!-- end questions -->

    <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
      <button type="submit" id="submitBtn">Submit Answers</button>
      <button type="button" class="secondary" id="downloadBtn" disabled>Download Answers (.txt)</button>
      <div style="margin-left:auto" class="muted">Make sure your name is filled before submitting.</div>
    </div>
    <p id="submitMsg" class="muted" style="display:none;margin-top:8px;color:green;">Answers saved locally. Download enabled.</p>
  </form>
</main>

<script>
(function(){
  // Config
  var ACCESS_CODE = "PAKSIT2025";
  var PASS_PERCENT = 80; // pass if >= 80%
  var totalSeconds = 35*60, timerInterval = null, examStarted = false;

  var timerEl=document.getElementById('timer');
  var examForm=document.getElementById('examForm');
  var accessSection=document.getElementById('accessCodeSection');
  var examCodeBtn=document.getElementById('examCodeBtn');
  var examCodeInput=document.getElementById('examCodeInput');
  var codeError=document.getElementById('codeError');
  var downloadBtn=document.getElementById('downloadBtn');
  var submitMsg=document.getElementById('submitMsg');

  // Shuffle questions (preserve label+select pairs), then renumber names so grading maps to displayed order
  function shuffleQuestions(){
    const form = document.getElementById('examForm');
    // collect pairs (label + select) before the submit button section
    const nodes = Array.from(form.children);
    const pairs = [];
    for (let i = 0; i < nodes.length; i++){
      const el = nodes[i];
      if (el.tagName === 'LABEL'){
        // next non-text node that's a SELECT
        let j = i+1;
        while(j < nodes.length && nodes[j].tagName !== 'SELECT') j++;
        if (j < nodes.length && nodes[j].tagName === 'SELECT'){
          pairs.push([el, nodes[j]]);
          i = j; // advance
        }
      }
    }
    // randomize pairs
    for (let i = pairs.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [pairs[i], pairs[j]] = [pairs[j], pairs[i]];
    }
    // find insertion point (the div that contains submit buttons)
    const submitSection = Array.from(form.children).find(c => c.tagName === 'DIV' && c.innerHTML.includes('Submit Answers'));
    // remove all original pairs from form
    pairs.forEach(p => {
      if (p[0].parentNode === form) form.removeChild(p[0]);
      if (p[1].parentNode === form) form.removeChild(p[1]);
    });
    // re-insert in shuffled order and renumber select names to q1..qN in display order
    pairs.forEach((p, idx) => {
      form.insertBefore(p[0], submitSection);
      form.insertBefore(p[1], submitSection);
      // rename select to q{idx+1}
      p[1].name = 'q' + (idx+1);
    });
    // Also, for safety, ensure labels do not have "for" attributes that mispoint
  }

  function updateTimerDisplay(){
    var m=Math.floor(totalSeconds/60), s=totalSeconds%60;
    timerEl.textContent=(m<10?'0'+m:m)+':'+(s<10?'0'+s:s);
  }
  function startTimer(){
    clearInterval(timerInterval);
    timerInterval=setInterval(function(){
      totalSeconds--;
      if(totalSeconds<=0){ clearInterval(timerInterval); lockExam(); return; }
      updateTimerDisplay();
    },1000);
  }
  function lockExam(){
    examForm.querySelectorAll('select,input').forEach(el=>el.disabled=true);
    submitMsg.style.display='block';
    submitMsg.textContent='Time is up. Exam ended.';
    // auto-submit results when time is up
    submitAnswers(true);
  }

  // Prevent copy/paste/context menu and some shortcuts
  document.addEventListener('contextmenu',e=>e.preventDefault());
  document.addEventListener('copy',e=>e.preventDefault());
  document.addEventListener('cut',e=>e.preventDefault());
  document.addEventListener('selectstart',e=>e.preventDefault());
  document.addEventListener('keydown',function(e){
    if((e.ctrlKey||e.metaKey) && ['c','x','u','s','a','p'].includes(e.key.toLowerCase())) e.preventDefault();
  });

  function resetExam(reason){
    if(!examStarted) return;
    alert("Exam reset due to " + reason + ". The page will reload.");
    location.reload();
  }
  document.addEventListener("visibilitychange",function(){ if(document.hidden && examStarted) resetExam("tab change"); });
  window.addEventListener("blur",function(){ if(examStarted) resetExam("window minimize or focus loss"); });

  // Start exam
  examCodeBtn.addEventListener('click', function(){
    if((examCodeInput.value||'').trim() === ACCESS_CODE){
      codeError.style.display='none';
      shuffleQuestions();
      accessSection.classList.add('hidden');
      examForm.classList.remove('hidden');
      examStarted = true;
      updateTimerDisplay();
      startTimer();
    } else {
      codeError.style.display='block';
    }
  });

  examCodeInput.addEventListener('keydown', function(e){ if(e.key === 'Enter'){ e.preventDefault(); examCodeBtn.click(); } });

  // Submit handler
  examForm.addEventListener('submit', function(e){
    e.preventDefault();
    // Validate name
    var name = document.getElementById('studentName').value.trim();
    if(!name){ alert('Please enter your name before submitting.'); return; }
    submitAnswers(false);
  });

  // Submit or auto-submit
  function submitAnswers(isTimeout){
    clearInterval(timerInterval);
    examStarted = false;
    var name = document.getElementById('studentName').value.trim() || 'UNKNOWN';
    var total = 40, correct = 0;
    var reportLines = [];
    reportLines.push('Student: ' + name);
    reportLines.push('Timestamp: ' + new Date().toISOString());
    reportLines.push('');

    for(var i=1;i<=total;i++){
      var sel = examForm.querySelector('[name=q'+i+']');
      var val = sel ? sel.value : '';
      // Determine correct answer by checking which option had the selected attribute originally.
      // Because we renamed names during shuffle, we need to find the correct option by inspecting option elements.
      var correctOption = '';
      if(sel){
        for(var k=0;k<sel.options.length;k++){
          if(sel.options[k].hasAttribute('selected')){
            correctOption = sel.options[k].value;
            break;
          }
        }
      }
      if(val === correctOption){
        correct++;
      } else {
        reportLines.push('Q' + i + ': Your=' + (val||'None') + ' | Correct=' + (correctOption || 'Unknown'));
      }
    }
    var percent = Math.round((correct/total)*100);
    var passed = percent >= PASS_PERCENT;
    alert('Your score: ' + correct + '/' + total + ' (' + percent + '%) – ' + (passed ? 'Passed' : 'Failed'));
    // Save downloadable data: include per-question chosen and correct where feasible
    var detailed = [];
    detailed.push('Student: ' + name);
    detailed.push('Score: ' + correct + '/' + total + ' (' + percent + '%) – ' + (passed ? 'Passed' : 'Failed'));
    detailed.push('');
    for(var j=1;j<=total;j++){
      var s = examForm.querySelector('[name=q'+j+']');
      var chosen = s ? (s.value || 'None') : 'None';
      var corr = '';
      if(s){
        for(var m=0;m<s.options.length;m++){
          if(s.options[m].hasAttribute('selected')) { corr = s.options[m].value; break; }
        }
      }
      detailed.push('Q' + j + ': Your=' + chosen + ' | Correct=' + (corr || 'Unknown'));
    }
    window._latestExamData = detailed.join('\n');
    downloadBtn.disabled = false;
    submitMsg.style.display='block';
    submitMsg.textContent='Answers saved locally. Click "Download Answers" to save a text file.';
  }

  downloadBtn.addEventListener('click', function(){
    var data = window._latestExamData || '';
    if(!data){ alert('No answers to download. Submit first.'); return; }
    var blob = new Blob([data], { type: 'text/plain' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = (document.getElementById('studentName').value || 'answers') + '_answers.txt';
    document.body.appendChild(a);
    a.click();
    setTimeout(function(){ URL.revokeObjectURL(url); a.remove(); },3000);
  });

  // Initial timer display
  updateTimerDisplay();
})();
</script>
</body>
</html>
